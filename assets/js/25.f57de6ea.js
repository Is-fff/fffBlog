(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{300:function(t,a,s){t.exports=s.p+"assets/img/vue2defect.40745c0d.png"},328:function(t,a,s){"use strict";s.r(a);var n=s(14),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"vue2和vue3的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue2和vue3的区别"}},[t._v("#")]),t._v(" Vue2和Vue3的区别")]),t._v(" "),a("p",[a("strong",[t._v("渲染性能")]),t._v("：Vue3相对于Vue2来说在渲染性能上有所提升。Vue3通过使用"),a("strong",[t._v("重写的响应系统和优化的虚拟DOM算法")]),t._v(",提供了更快的渲染性能。")]),t._v(" "),a("p",[a("strong",[t._v("包体积")]),t._v("：Vue3相对于Vue2来说在包体积上更小。Vue3采用了一些新的构建方式（Webpack）和"),a("strong",[t._v("Tree-Shaking技术")]),t._v(",使得生成的包更小。这减少了加载时间并提高了性能。")]),t._v(" "),a("p",[a("strong",[t._v("Composition API")]),t._v(" :Vue3引入了**Composition API,**它是一种基于函数的API风格,允许开发者根据逻辑组织代码。Composition API提供了更好的代码复用和组织方式,使得组件更加可读、可维护。")]),t._v(" "),a("p",[a("strong",[t._v("TypeScript支持")]),t._v("：Vue3对TypeScript的支持进一步改进,提供了更好的类型推断和错误检查。这使得使用TypeScript开发Vue应用程序更加流畅。Vue3基于Ts编写")]),t._v(" "),a("p",[a("strong",[t._v("响应式系统")]),t._v("：Vue3的响应式系统经过了重写,提供了更好的性能和更丰富的功能。它支持了跨层级的响应式数据传递、自定义的响应式触发器和批量更新等特性。")]),t._v(" "),a("h3",{attrs:{id:"响应式的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#响应式的区别"}},[t._v("#")]),t._v(" 响应式的区别")]),t._v(" "),a("ul",[a("li",[t._v("Vue2响应式：基于Object.defineProperty()实现的。")])]),t._v(" "),a("p",[a("strong",[t._v("defineProperty实际上是对象里面基本方法之一，而proxy是针对整个对象所有基本方法的拦截器。这是最本质的区别！！！！")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Vue2实现响应式")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" v "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拿到原始值")]),t._v("\nObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineProperty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 读的时候 运行get")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'读取'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" v\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 赋值的时候，运行set")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" v"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'更改'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            v "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" val\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("在vue2里面观察的方式就是深度遍历每一个属性，把每一个"),a("strong",[t._v("属性的读取和赋值变成函数")]),t._v("，只要变成函数，就可以插一脚。")]),t._v(" "),a("p",[a("strong",[t._v("缺陷")]),t._v("：由于它是针对每个属性的监听，所以他就必须要进行深度的遍历，这会有效率的损失。")]),t._v(" "),a("p",[a("img",{attrs:{src:s(300),alt:"img"}})]),t._v(" "),a("ul",[a("li",[t._v("Vue3响应式：基于Proxy实现的。")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Vue3代理实现响应式")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" obj "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("a")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("b")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("c")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("a")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("b")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 观察")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Proxy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 读的时候 运行get")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" v "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'读取'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" v\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" val"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 赋值的时候，运行set")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" val"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'更改'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" val\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("deleteProperty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 删除属性监听")]),t._v("\n\t\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nproxy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\nproxy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b\nproxy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ccccccccc\n\n")])])]),a("p",[t._v("// 总结： 深度监听，性能更好\n// 可以监听 新增/删除 属性\n// 可监听数组变化")]),t._v(" "),a("p",[t._v("// 能规避Object.definePropety的问题\n// 缺陷： 无法兼容所有的浏览器，无法polyfill")]),t._v(" "),a("h2",{attrs:{id:"diff算法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#diff算法"}},[t._v("#")]),t._v(" Diff算法")]),t._v(" "),a("h3",{attrs:{id:"运行时机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行时机"}},[t._v("#")]),t._v(" 运行时机")]),t._v(" "),a("p",[t._v("当我们当前组件所依赖的数值"),a("strong",[t._v("更新和组件创建")]),t._v("时运行"),a("strong",[t._v("update")]),t._v("函数，update函数会调用组件的"),a("strong",[t._v("render")]),t._v("函数，render生成"),a("strong",[t._v("新的虚拟dom树")]),t._v("，update的到新虚拟dom树的根节点，然后进入update函数内部，将_vnode也就是旧虚拟dom树替换成新的虚拟dom树，然后用一个变量将旧虚拟dom树保存起来，接下来"),a("strong",[t._v("调用patch函数进行diff比对")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"比对原则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#比对原则"}},[t._v("#")]),t._v(" 比对原则")]),t._v(" "),a("p",[a("strong",[t._v("深度优先，同层比较")])]),t._v(" "),a("ol",[a("li",[t._v("尽量不动")]),t._v(" "),a("li",[t._v("能修改属性修改属性")]),t._v(" "),a("li",[t._v("能移动dom移动dom")]),t._v(" "),a("li",[t._v("实在不行再删除或新增真实dom")])]),t._v(" "),a("h3",{attrs:{id:"比对过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#比对过程"}},[t._v("#")]),t._v(" 比对过程")]),t._v(" "),a("ol",[a("li",[t._v("对比tag，标签名")]),t._v(" "),a("li",[t._v("对比key（若存在）")]),t._v(" "),a("li",[t._v("对比其它属性")])]),t._v(" "),a("h3",{attrs:{id:"子节点比对-子节点数组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#子节点比对-子节点数组"}},[t._v("#")]),t._v(" 子节点比对（子节点数组）")]),t._v(" "),a("p",[t._v("采用双指针遍历对比，首尾指针，依次以")]),t._v(" "),a("p",[t._v("头头->头尾->尾头->尾尾 比较")]),t._v(" "),a("p",[t._v("当start>end，则比对完毕")]),t._v(" "),a("h2",{attrs:{id:"生命周期钩子-vue2与vue3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生命周期钩子-vue2与vue3"}},[t._v("#")]),t._v(" 生命周期钩子（Vue2与Vue3）")]),t._v(" "),a("h3",{attrs:{id:"vue2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue2"}},[t._v("#")]),t._v(" Vue2")]),t._v(" "),a("p",[t._v("beforeCreate")]),t._v(" "),a("p",[t._v("created")]),t._v(" "),a("p",[t._v("beforeMount")]),t._v(" "),a("p",[t._v("mounted")]),t._v(" "),a("p",[t._v("beforeUpdate")]),t._v(" "),a("p",[t._v("updated")]),t._v(" "),a("p",[t._v("beforeUnMounted")]),t._v(" "),a("p",[t._v("unMounted")]),t._v(" "),a("p",[t._v("beforeDestroy")]),t._v(" "),a("p",[t._v("destroyd")]),t._v(" "),a("h3",{attrs:{id:"vue3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue3"}},[t._v("#")]),t._v(" Vue3")]),t._v(" "),a("p",[t._v("setup()//去掉beforeCreate和created,代替created")]),t._v(" "),a("p",[t._v("onBeforeMounted()")]),t._v(" "),a("p",[t._v("onMounted()")]),t._v(" "),a("p",[t._v("onBeforeUpdate()")]),t._v(" "),a("p",[t._v("onUpdated()")]),t._v(" "),a("p",[t._v("onBeforeUnmount()")]),t._v(" "),a("p",[t._v("onUnmounted()")]),t._v(" "),a("p",[t._v("//去掉了created和destroy")]),t._v(" "),a("h2",{attrs:{id:"父子组件生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#父子组件生命周期"}},[t._v("#")]),t._v(" 父子组件生命周期")]),t._v(" "),a("p",[t._v("父beforeCreate -> 父created -> 父beforeMount -> 子beforeCreate -> 子created -> 子beforeMount -> 子mounted -> 父mounted->父beforeUpdate->子beforeUpdate->子updated->父updated->父beforeDestroy->子beforeDestroy->子destroyed->父destroyed\n即：父组件可以单独被create,在挂载前才会去看是否有子组件，其它生命周期则从内向外更新。")]),t._v(" "),a("h2",{attrs:{id:"订阅发布模式和观察者模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#订阅发布模式和观察者模式"}},[t._v("#")]),t._v(" 订阅发布模式和观察者模式")]),t._v(" "),a("h3",{attrs:{id:"订阅发布模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#订阅发布模式"}},[t._v("#")]),t._v(" 订阅发布模式")]),t._v(" "),a("p",[t._v("完成订阅发布流程需要三个角色："),a("strong",[t._v("订阅者，发布者，发布中心")])]),t._v(" "),a("p",[t._v("流程：订阅者需要向事件中心订阅指定的事件 -> 发布者向事件中心发布指定事件内容 -> 事件中心通知订阅者 -> 订阅者收到消息")]),t._v(" "),a("p",[t._v("代码实现，可以参考eventEmiter")]),t._v(" "),a("p",[t._v("常见场景：事件处理机制")]),t._v(" "),a("p",[a("strong",[t._v("特点")]),t._v("：发布者和订阅者只关注事件本身，通过事件中心订阅/发布，不关注是谁发布/订阅，两者之间是"),a("strong",[t._v("解耦")]),t._v("的")]),t._v(" "),a("p",[a("strong",[t._v("优点")]),t._v("：发布者订阅者互相解耦，更加灵活")]),t._v(" "),a("p",[a("strong",[t._v("缺点")]),t._v("：1.使用不当容易造成数据流混乱；2.需要维护事件队列，性能消耗大")]),t._v(" "),a("h3",{attrs:{id:"观察者模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#观察者模式"}},[t._v("#")]),t._v(" 观察者模式")]),t._v(" "),a("p",[t._v("完成观察者模式需要两个角色："),a("strong",[t._v("被观察者，观察者")])]),t._v(" "),a("p",[a("strong",[t._v("观察者模式")]),t._v("定义了一种一对多的依赖关系，让多个"),a("strong",[t._v("观察者")]),t._v("对象同时监听某一个目标对象，当这个目标对象的状态发生变化时，会通知所有"),a("strong",[t._v("观察者")]),t._v("对象，使它们能够自动更新。")]),t._v(" "),a("p",[t._v("常见场景：vue2响应式，mobx响应式")]),t._v(" "),a("p",[t._v("代码实现(vue2响应式实现)")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 观察监听一个对象成员的变化\n * @param {Object} obj 观察的对象\n * @param {String} targetVariable 观察的对象成员\n * @param {Function} callback 目标变化触发的回调\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("observer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" targetVariable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineProperty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" targetVariable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("targetVariable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//状态改变")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("targetVariable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" val\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 目标主动通知观察者")]),t._v("\n      callback "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("targetVariable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    callback "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("targetVariable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("特点")]),t._v("：观察者和被观察者是直接关联的，是耦合的")]),t._v(" "),a("p",[a("strong",[t._v("优点")]),t._v("：便于实现响应式，目标资源的改变会通知使用者")]),t._v(" "),a("p",[a("strong",[t._v("缺点")]),t._v("：两者相互耦合，使得这种方式不够灵活")]),t._v(" "),a("h2",{attrs:{id:"vue-nexttick"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-nexttick"}},[t._v("#")]),t._v(" Vue.nextTick")]),t._v(" "),a("h3",{attrs:{id:"作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#作用"}},[t._v("#")]),t._v(" 作用")]),t._v(" "),a("p",[t._v("在下次 DOM 更新循环结束之后执行延迟回调。在修改数据之后立即使用这个方法，获取更新后的 DOM。")]),t._v(" "),a("h3",{attrs:{id:"应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用场景"}},[t._v("#")]),t._v(" 应用场景")]),t._v(" "),a("p",[t._v("列表数据更新之后，获取列表组件的高度")]),t._v(" "),a("h3",{attrs:{id:"实现原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现原理"}},[t._v("#")]),t._v(" 实现原理")]),t._v(" "),a("p",[t._v("nextTick内部动态维护一个"),a("strong",[t._v("callbacks数组")]),t._v("，并将这个回调数组放到异步队列里面依次执行，根据不同的浏览器支持，异步的实现方式Promise.then > MutationObserver > setImmediate > setTimeout。")]),t._v(" "),a("p",[t._v("因此在标准浏览器中，nextTick通过Promise.resolve().then将回调数组放到微任务队列中执行")]),t._v(" "),a("h3",{attrs:{id:"vue2中响应式数据改变-发生了什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue2中响应式数据改变-发生了什么"}},[t._v("#")]),t._v(" Vue2中响应式数据改变，发生了什么")]),t._v(" "),a("p",[t._v("this.a = 2,触发了setter方法，通过dep.notify()，通知watcher更新视图，调用watcher.update()，采用queueWatcher去重，并将watcher.run放入nextTick**（nextTick(watcher.run)）**")]),t._v(" "),a("h3",{attrs:{id:"代码输出案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代码输出案例"}},[t._v("#")]),t._v(" 代码输出案例")]),t._v(" "),a("p",[a("img",{attrs:{src:"img/outputTest.png",alt:"img"}})]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//nextTick 1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//resolve 2")]),t._v("\n")])])]),a("p",[t._v("第四行执行nextTick，将回调放置在callbacks数组并置入微任务队列，此时微队列：[...callbacks]")]),t._v(" "),a("p",[t._v("第七行将Promise回调置入微队列，此时微队列：[...callbacks,()=>{console.log(resolve)}]")]),t._v(" "),a("p",[t._v("第十行修改a，执行watcher.update，将watcher.run放入nextTick的callbacks")]),t._v(" "),a("p",[t._v("此时callbacks = [()=>{console.log(nextTick)},watcher.run]")]),t._v(" "),a("p",[t._v("微任务队列：[...callback,()=>{console.log(resolve)}]")]),t._v(" "),a("h2",{attrs:{id:"为什么推荐使用ref而不用reactive"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么推荐使用ref而不用reactive"}},[t._v("#")]),t._v(" 为什么推荐使用ref而不用reactive")]),t._v(" "),a("p",[t._v("1.reative只支持引用类型，而ref支持基本数据类型和引用类型，引用类型内部也是用reactive实现")]),t._v(" "),a("p",[t._v("2。"),a("strong",[t._v("重新分配新对象时，由于reactive返回的是Proxy对象引用，因此重新赋值对象会导致响应式丢失，而对ref.value重新赋值不会失去响应式")])])])}),[],!1,null,null,null);a.default=e.exports}}]);